{
    "version": "https://jsonfeed.org/version/1",
    "title": "西芹的小站 • All posts by \"微信小程序\" tag",
    "description": "",
    "home_page_url": "https://xiqin-huang.github.io",
    "items": [
        {
            "id": "https://xiqin-huang.github.io/2023/10/12/bian-cheng/wei-xin-yun-kai-fa/",
            "url": "https://xiqin-huang.github.io/2023/10/12/bian-cheng/wei-xin-yun-kai-fa/",
            "title": "微信云开发",
            "date_published": "2023-10-12T10:49:32.914Z",
            "content_html": "<h1 id=\"day1\"><a class=\"markdownIt-Anchor\" href=\"#day1\">#</a> day1</h1>\n<h2 id=\"增删查改\"><a class=\"markdownIt-Anchor\" href=\"#增删查改\">#</a> 增删查改</h2>\n<p>今天学会了在微信开发中如何对数据库进行增删改查，和进行页面之间的跳转，还有数据之间的传递。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'goods'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n                <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span>goodname<span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span>price\n                <span class=\"token punctuation\">}</span> \n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"id传递\"><a class=\"markdownIt-Anchor\" href=\"#id传递\">#</a> ID 传递</h2>\n<p>data-id 与后面获取的变量名 id 相对应</p>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>view</span> <span class=\"token attr-name\">bindtap</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">'</span>goDetail<span class=\"token punctuation\">'</span></span> <span class=\"token attr-name\">data-id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{item._id}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">&gt;</span></span>商品名：{{item.name}},价格：{{item.price}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>view</span><span class=\"token punctuation\">&gt;</span></span>\n\nconsole.log(\"点击了跳转商品详情\",event.currentTarget.dataset.id)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p><strong>在 app.json 中的 pages 新增页面，页面的次序是有影响的</strong></p>\n<h2 id=\"返回结果\"><a class=\"markdownIt-Anchor\" href=\"#返回结果\">#</a> 返回结果</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'goods'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token operator\">=&gt;</span><span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'成功'</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token operator\">=&gt;</span><span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'失败'</span><span class=\"token punctuation\">,</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<hr>\n<br>\n<h1 id=\"day2\"><a class=\"markdownIt-Anchor\" href=\"#day2\">#</a> day2</h1>\n<p>通过封装方法，使用 this 进行调用，在使用<strong> this 时要注意所在的作用域</strong>。</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>使用全局变量来传递值，可以使用 let，也可以使用 var 变量</p>\n<p>可以在 updated 中的 status 中看出是否有更新成功，在对数据库进行操作时要注意权限问题</p>\n<p>使用 return 截断错误，方便调试</p>\n<p><strong>接受数字小心是字符串，可以通过是否变蓝看出，可以使用 parseInt (price) 来进行强制转换</strong></p>\n<p>可以使用变量接收数据库对象，来方便操作</p>\n<p>限制返回的数据条数 <code>.limit(3)</code></p>\n<p>跳过若干条数据，用于分页 <code>.skip(1)</code></p>\n<p><strong>要注意套餐所给的量，小心写，不然用完就要开新的套餐。数据库的读写次数是有限制的</strong></p>\n<h2 id=\"快捷键使用\"><a class=\"markdownIt-Anchor\" href=\"#快捷键使用\">#</a> 快捷键使用</h2>\n<table>\n<thead>\n<tr>\n<th>快捷键</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Ctrl+B</td>\n<td>编译</td>\n</tr>\n<tr>\n<td>Ctrl+z</td>\n<td>撤销操作</td>\n</tr>\n<tr>\n<td>Ctrl+s</td>\n<td>保存</td>\n</tr>\n<tr>\n<td>shift+Alt + 方向键</td>\n<td>向对应方向复制当前行</td>\n</tr>\n<tr>\n<td>Ctrl+ALT+l</td>\n<td>格式化代码</td>\n</tr>\n<tr>\n<td>shift+Alt+f</td>\n<td>全局搜索</td>\n</tr>\n<tr>\n<td>Ctrl+f</td>\n<td>当前页面搜索</td>\n</tr>\n<tr>\n<td>Ctrl+h</td>\n<td>查找并替换</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"绑定事件\"><a class=\"markdownIt-Anchor\" href=\"#绑定事件\">#</a> 绑定事件</h2>\n<p>前端界面绑定方法，bindtap 点击事件，bindinput 输入事件，然后在后端函数中获取值</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 前端页面</span>\n<span class=\"token operator\">&lt;</span>input bindinput<span class=\"token operator\">=</span><span class=\"token string\">\"getPrice\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>input<span class=\"token operator\">&gt;</span>\n<span class=\"token comment\">// 后端页面</span>\n<span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        price <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>detail<span class=\"token punctuation\">.</span>value\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"弹窗提示确认是否删除\"><a class=\"markdownIt-Anchor\" href=\"#弹窗提示确认是否删除\">#</a> 弹窗提示确认是否删除</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span><span class=\"token function\">showModal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">cancelColor</span><span class=\"token operator\">:</span> <span class=\"token string\">'cancelColor'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span><span class=\"token string\">\"是否确定删除\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span><span class=\"token string\">\"您再仔细想一想，是否真的要删除，删除后不可恢复\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>confirm<span class=\"token operator\">==</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token comment\">//用户点击了确认</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'点击确定'</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>cancel<span class=\"token operator\">==</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token comment\">//用户点击了取消</span>\n                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'点击取消'</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"页面跳转\"><a class=\"markdownIt-Anchor\" href=\"#页面跳转\">#</a> 页面跳转</h2>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span><span class=\"token function\">navigateTo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token string\">'/pages/demo1/demo1'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"升序排列\"><a class=\"markdownIt-Anchor\" href=\"#升序排列\">#</a> 升序排列</h2>\n<p>asc 表示升序，desc 为降序，前面是关键字</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.orderBy(\"price\",'asc')<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"command命令筛选\"><a class=\"markdownIt-Anchor\" href=\"#command命令筛选\">#</a> command 命令筛选</h2>\n<p>可以在微信开放文档<a href=\"https://\"> https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/Command.html</a> 中查看具体，常见的有 gt 大于，lt 小于，gte 大于等于</p>\n<p>还可以使用 and 关键字设置多个查找条件，要注意格式 and ([]),[] 中用 {} 包裹筛选条件</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span>db<span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">.</span><span class=\"token function\">gt</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token comment\">// 组合查找</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">where</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">and</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">gt</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//大于10</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span> _<span class=\"token punctuation\">.</span><span class=\"token function\">lt</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//小于20</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"云函数\"><a class=\"markdownIt-Anchor\" href=\"#云函数\">#</a> 云函数</h2>\n<h3 id=\"初始化云函数\"><a class=\"markdownIt-Anchor\" href=\"#初始化云函数\">#</a> 初始化云函数</h3>\n<p>新增的文件夹一定要与 pages 平级，可以先点击与 pages 平级的文件，再点击新增文件夹，命名为 cloud，或者在云函数列表中右键新增 node.js 云函数</p>\n<p>在 project.config.json 文件顶部配置云函数所在目录为 cloud，可以根据喜欢换名字，只要能对应起来就可以</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token string-property property\">\"cloudfunctionRoot\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"/cloud\"</span><span class=\"token punctuation\">,</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>保存成功，此时 cloud 文件夹会出现云朵标志，代表初始化成功</p>\n<h3 id=\"注意事项\"><a class=\"markdownIt-Anchor\" href=\"#注意事项\">#</a> 注意事项</h3>\n<p>要注意云函数的环境要和小程序的环境对应</p>\n<p>文件夹右键选择新建 node.js 文件</p>\n<h3 id=\"云函数的调用\"><a class=\"markdownIt-Anchor\" href=\"#云函数的调用\">#</a> 云函数的调用</h3>\n<p>使用 callFunction, 在 name 处填写需要调用的云函数名称</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//云函数的调用</span>\n<span class=\"token comment\">//传统写法</span>\nwx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">callFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'getData'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'请求云函数成功'</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">fail</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'请求云函数失败'</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 建议写法</span>\nwx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">callFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'getData'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'成功'</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 传递值</span>\n        <span class=\"token literal-property property\">openid</span><span class=\"token operator\">:</span> res<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">.</span>openid\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'失败'</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"云函数获取数据\"><a class=\"markdownIt-Anchor\" href=\"#云函数获取数据\">#</a> 云函数获取数据</h3>\n<p>云函数只要有变动，就要重新部署，否则云函数不生效</p>\n<p>部署选择上传并部署：云端安装依赖 (不上传 node_modules)</p>\n<p>如果只改变了 js 文件，可点击对应的 js 文件，右键选择云函数增量上传：更新文件</p>\n<p>而且在云函数中操作数据库时，不再需要写 wx，wx 只在本地编写的时候才需要写</p>\n<p><strong>有多个云开发环境的时候，需要指定环境，或者使用 DYNAMIC_CURRENT_ENV 指定为当前环境（提倡写法）</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">cloud<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">env</span><span class=\"token operator\">:</span> cloud<span class=\"token punctuation\">.</span><span class=\"token constant\">DYNAMIC_CURRENT_ENV</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<hr>\n<h1 id=\"day3\"><a class=\"markdownIt-Anchor\" href=\"#day3\">#</a> day3</h1>\n<p>文件可以导出为 json 格式，可以使用记事本进行打开</p>\n<p>导入的时候可以选择 insert 和 upsert 模式，使用 insert 时注意不要有多个 id 相同的情况出现，否则会报错。建议使用 upsert 模式。</p>\n<p>云函数一次最多可返回 100 条数据，本地一次最多可返回 20 条数据。</p>\n<p><strong>云函数中 console 在云端打印，我们在调试器中只能看到本地的 console。</strong></p>\n<h2 id=\"向云函数传递值\"><a class=\"markdownIt-Anchor\" href=\"#向云函数传递值\">#</a> 向云函数传递值</h2>\n<p>在 data 中传递值，在云函数中使用 event 接收对应的值</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">callFunction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    name <span class=\"token operator\">=</span> <span class=\"token string\">'update0129'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span>id<span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">price</span><span class=\"token operator\">:</span><span class=\"token number\">20</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 云函数</span>\nevent<span class=\"token punctuation\">.</span>id和event<span class=\"token punctuation\">.</span>price<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<hr>\n<h1 id=\"day4\"><a class=\"markdownIt-Anchor\" href=\"#day4\">#</a> day4</h1>\n<p>在编写云函数时，要注意先保存再上传到云端。</p>\n<p>创建云函数不难，相当于把本地的代码移到云函数，去掉 wx</p>\n<p>可以导入源码，但是如果使用别人的源码需要改开发者 ID</p>\n<h2 id=\"选择文件接口\"><a class=\"markdownIt-Anchor\" href=\"#选择文件接口\">#</a> 选择文件接口</h2>\n<p><strong>用户选择文件接口（api)</strong></p>\n<p><a href=\"https://\">https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseMedia.html</a></p>\n<p>也可以选择 chooseImage 接口</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token function\">chooseImg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//上传图片的第一步</span>\n    wx<span class=\"token punctuation\">.</span><span class=\"token function\">chooseImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">count</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//可以选择多少张图片</span>\n        <span class=\"token literal-property property\">sizeType</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'original'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'compressed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">sourceType</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'album'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'camera'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//设置图片来源</span>\n        <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span><span class=\"token parameter\">res</span><span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">uploadImg</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>tempFilePaths<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"文件上传\"><a class=\"markdownIt-Anchor\" href=\"#文件上传\">#</a> 文件上传</h2>\n<p>然后就可以对获取到的文件进行上传</p>\n<p><a href=\"https://\">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/uploadFile/client.uploadFile.html</a></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token function\">uploadImg</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">temfile</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'要上传图片的临时路径'</span><span class=\"token punctuation\">,</span>temfile<span class=\"token punctuation\">)</span>\n    wx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">cloudPath</span><span class=\"token operator\">:</span> <span class=\"token string\">'西芹1.png'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">filePath</span><span class=\"token operator\">:</span> temfile<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 文件路径</span>\n        <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token parameter\">res</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'上传成功'</span><span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">fail</span><span class=\"token operator\">:</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'上传失败'</span><span class=\"token punctuation\">,</span>err<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>点击预览即可在手机上体验使用小程序上传图片</p>\n<h1 id=\"day5\"><a class=\"markdownIt-Anchor\" href=\"#day5\">#</a> day5</h1>\n<p>存储图片路径，使用存储中的下载地址，复制的时候注意不要复制问号后面的东西，因为是时间戳，可能导致图片失效。</p>\n<h2 id=\"上传视频\"><a class=\"markdownIt-Anchor\" href=\"#上传视频\">#</a> 上传视频</h2>\n<p><a href=\"https://\">https://developers.weixin.qq.com/miniprogram/dev/api/media/video/wx.chooseVideo.html</a></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span><span class=\"token function\">chooseVideo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">sourceType</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'album'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'camera'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">maxDuration</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">camera</span><span class=\"token operator\">:</span> <span class=\"token string\">'back'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>tempFilePath<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>上传视频有时候比较慢，需要耐心等待。</p>\n<p>通过 type 值判断是上传视频还是图片</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>image wx<span class=\"token operator\">:</span><span class=\"token keyword\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"{{showImg}}\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"{{imgUrl}}\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>image<span class=\"token operator\">&gt;</span>\n<span class=\"token operator\">&lt;</span>video wx<span class=\"token operator\">:</span><span class=\"token keyword\">if</span><span class=\"token operator\">=</span><span class=\"token string\">\"{{showVideo}}\"</span> src<span class=\"token operator\">=</span><span class=\"token string\">\"{{videoUrl}}\"</span><span class=\"token operator\">&gt;</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>video<span class=\"token operator\">&gt;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h2 id=\"上传word和pdf文件\"><a class=\"markdownIt-Anchor\" href=\"#上传word和pdf文件\">#</a> 上传 Word 和 PDF 文件</h2>\n<p><a href=\"https://\">https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseMessageFile.html</a></p>\n<p>从客户端会话选择文件。</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">wx.chooseMessageFile({\n  count: 10,\n  type: 'image',\n  success (res) {\n    // tempFilePath可以作为img标签的src属性显示图片\n    const tempFilePaths = res.tempFiles\n  }\n})<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"文件下载\"><a class=\"markdownIt-Anchor\" href=\"#文件下载\">#</a> 文件下载</h2>\n<p><a href=\"https://\">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/storage/downloadFile/client.downloadFile.html</a></p>\n<p>从云存储空间下载文件</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">wx<span class=\"token punctuation\">.</span>cloud<span class=\"token punctuation\">.</span><span class=\"token function\">downloadFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">fileID</span><span class=\"token operator\">:</span> <span class=\"token string\">'a7xzcb'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'下载成功'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=&gt;</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'下载失败'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"day6\"><a class=\"markdownIt-Anchor\" href=\"#day6\">#</a> day6</h1>\n<p>vue 文件中，data 初始化需要使用的数据，生命周期函数写在 methods 外面，而自定义的函数写在 methods 内。</p>\n<p><strong>传递值不需要 setdata，只需要 this. 变量名 = 值即可。</strong></p>\n<h2 id=\"目录结构\"><a class=\"markdownIt-Anchor\" href=\"#目录结构\">#</a> 目录结构</h2>\n<table>\n<thead>\n<tr>\n<th>目录名</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>pages</td>\n<td>页面存放目录</td>\n</tr>\n<tr>\n<td>static</td>\n<td>静态文件目录</td>\n</tr>\n<tr>\n<td>APP.vue</td>\n<td>应用入口文件，和小程序 app.js 类似</td>\n</tr>\n<tr>\n<td>main.js</td>\n<td>应用入口文件，注册 vue 等</td>\n</tr>\n<tr>\n<td>manifest.json</td>\n<td>项目配置</td>\n</tr>\n<tr>\n<td>pages.json</td>\n<td>页面配置</td>\n</tr>\n<tr>\n<td>common</td>\n<td>存放共用的文件</td>\n</tr>\n<tr>\n<td>components</td>\n<td>自定义组件目录</td>\n</tr>\n<tr>\n<td>store</td>\n<td>vuex 目录</td>\n</tr>\n<tr>\n<td>unpackage</td>\n<td>编译后的文件目录</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"前端控制语句\"><a class=\"markdownIt-Anchor\" href=\"#前端控制语句\">#</a> 前端控制语句</h2>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>v-bind</td>\n<td>可以简写为：，组件属性要使用 data 中定义的数据变量，或者组件属性使用表达式，要使用 v-bind 指定</td>\n</tr>\n<tr>\n<td>v-on</td>\n<td>可以简写为 @绑定事件</td>\n</tr>\n<tr>\n<td>v-model</td>\n<td>数据双向绑定，例如根据输入值动态改变 data 中的值</td>\n</tr>\n<tr>\n<td>v-if</td>\n<td>条件判断，决定某个内容或者区块是否挂载</td>\n</tr>\n<tr>\n<td>v-show</td>\n<td>条件判断，是否显示</td>\n</tr>\n<tr>\n<td>v-for</td>\n<td>列表渲染，遍历循环，可以使用 index 获取序号，可以使用 value 和 key 获取对象中的对应关系</td>\n</tr>\n</tbody>\n</table>\n<p>onclick 事件也能够通过写表达式改变值，.stop 可以阻止事件穿透</p>\n<h2 id=\"生命周期\"><a class=\"markdownIt-Anchor\" href=\"#生命周期\">#</a> 生命周期</h2>\n<h3 id=\"应用的生命周期appvue\"><a class=\"markdownIt-Anchor\" href=\"#应用的生命周期appvue\">#</a> 应用的生命周期（APP.vue)</h3>\n<table>\n<thead>\n<tr>\n<th>周期名</th>\n<th>意义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>onLaunch</td>\n<td>应用初始化完成执行，全局只执行一次，通常做登录的处理</td>\n</tr>\n<tr>\n<td>onShow</td>\n<td>应用显示时执行，或者从后台进入前台</td>\n</tr>\n<tr>\n<td>onHide</td>\n<td>应用隐藏时执行，或者从前台进入后台</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"页面的生命周期\"><a class=\"markdownIt-Anchor\" href=\"#页面的生命周期\">#</a> 页面的生命周期</h3>\n<p>onReady 在 onShow 之后触发，因为要等待数据</p>\n<table>\n<thead>\n<tr>\n<th>周期名</th>\n<th>意义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>onLoad</td>\n<td>页面加载时触发</td>\n</tr>\n<tr>\n<td>onReady</td>\n<td>页面初次完成渲染时触发</td>\n</tr>\n<tr>\n<td>onShow</td>\n<td>页面显示时触发</td>\n</tr>\n<tr>\n<td>onUnload</td>\n<td>页面卸载时触发</td>\n</tr>\n<tr>\n<td>onHide</td>\n<td>页面隐藏时触发</td>\n</tr>\n</tbody>\n</table>\n<p><strong>在写完云函数之后，一定要先停止在模拟器上运行，在编译一次才可以的，然后上传到云端，就可以进行使用了</strong></p>\n<p><strong>v-model 真的是神器，省去了很多获取值的麻烦操作</strong></p>\n",
            "tags": [
                "云开发",
                "微信小程序"
            ]
        }
    ]
}